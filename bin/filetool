#!/usr/bin/env ruby
require_relative "../lib/filetool.rb"

if __FILE__ == $0
  
  command = ARGV[0]
  filename = ARGV[1]
  arg1 = ARGV[2]
  arg2 = ARGV[3]

  if command.nil? || filename.nil?
    puts "Usage:"
    puts " filetool show <file>"
    puts " filetool stats <file>"
    puts " filetool add <file> \"text\""
    puts " filetool search <file> \"text\""
    puts " filetool replace <file> \"from\" \"to\""
    puts " filetool create <file>"
    exit
  end

  begin
    case command
    when "show"
      puts Filetool.show(filename)

    when "stats"
      result = Filetool.stats(filename)
      puts "Lines: #{result[:lines]}"
      puts "Words: #{result[:words]}"
      puts "Chars: #{result[:chars]}"

    when "add"
      if arg1.nil?
        puts "Text to add is missing"
        exit 1
      end
      Filetool.add(filename, arg1)
      puts "Added text to #{filename}"

    when "search"
      if arg1.nil?
        puts "string to search is missing"
        exit 1
      end
      puts Filetool.search(filename, arg1)

    when "replace"
      if arg1.nil? || arg2.nil?
        puts "string to replace is missing"
        exit 1
      end
      puts Filetool.replace!(filename, arg1, arg2)

    when "create"
      Filetool.create(filename)
      puts "Created #{filename}"

    else
      puts "unknown command: #{command}"
    end
  rescue Errno::ENOENT
    puts "File not found: #{filename}"
    exit 1
  rescue Errno::EACCES
    puts "Permission denied: #{filename}"
    exit 1
  rescue => e
    puts "Unexpected error: #{e.message}"
    exit 1
  end
end